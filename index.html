<script>
    // --- 1. Question Data Array ---
    const quizQuestions = [
        {
            id: 1,
            text: "Q1: A 35-year-old patient presents with a localised, well-demarcated area of gingival enlargement on the buccal aspect of the maxillary right first molar. The lesion is firm, pale pink, and has been present for 6 months. What is the most likely diagnosis?",
            options: [
                "A) Chronic hyperplastic pulpitis",
                "B) Pyogenic granuloma",
                "C) Peripheral ossifying fibroma (Single Best Answer)",
                "D) Recurrent aphthous stomatitis"
            ],
            // In a real app, you'd track the correct answer here.
        },
        {
            id: 2,
            text: "Q2: Which of the following is the preferred local anaesthetic for a patient with a documented history of methemoglobinemia when extensive dental work is required?",
            options: [
                "A) Prilocaine",
                "B) Lidocaine",
                "C) Articaine",
                "D) Benzocaine (Avoided in Methemoglobinemia)",
            ],
        },
        {
            id: 3,
            text: "Q3: In paediatric dentistry, what is the recommended management for an enamel-dentin fracture of a permanent incisor with a positive pulpal sensitivity test and no radiographic sign of pulp exposure?",
            options: [
                "A) Direct pulp cap with MTA",
                "B) Apexification procedure",
                "C) Placement of a protective layer (e.g., glass ionomer) and permanent restoration (Standard Treatment)",
                "D) Pulpotomy with formocresol",
            ],
        }
        // Add more questions here to expand the mock test.
    ];

    let currentQuestionIndex = 0; // Starts at 0 for the first question
    const totalQuestions = quizQuestions.length;

    // --- 2. Core Functions ---

    function loadQuestion(index) {
        if (index < 0 || index >= totalQuestions) return;

        const question = quizQuestions[index];
        const questionPanel = document.querySelector('.question-panel');
        
        // Update Question Number Header
        document.querySelector('.question-number').textContent = `Question ${question.id} of ${totalQuestions}`;

        // Update Question Text
        questionPanel.querySelector('.question-text').textContent = question.text;

        // Update Options
        const optionsForm = questionPanel.querySelector('.options-form');
        optionsForm.innerHTML = ''; // Clear previous options

        question.options.forEach((optionText, i) => {
            const letter = String.fromCharCode(65 + i); // 65 is 'A'
            const optionHTML = `
                <label class="option-label">
                    <input type="radio" name="q${question.id}-answer" value="${letter.toLowerCase()}">
                    ${optionText}
                </label>
            `;
            optionsForm.innerHTML += optionHTML;
        });

        // Update Navigation Button States
        document.querySelector('.nav-btn.prev').disabled = (index === 0);
        document.querySelector('.nav-btn.next').disabled = (index === totalQuestions - 1);
        
        // Optional: Update the 'current' button status in the sidebar 
        // (This would require more complex status panel logic, but is good practice)
    }

    function handleNext() {
        if (currentQuestionIndex < totalQuestions - 1) {
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
            window.scrollTo(0, 0); // Scroll to top for new question
        }
    }

    function handlePrevious() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            loadQuestion(currentQuestionIndex);
            window.scrollTo(0, 0); // Scroll to top for new question
        }
    }

    // --- 3. Timer Function (Keep this the same) ---
    function startTimer(duration, display) {
        let timer = duration, hours, minutes, seconds;
        
        const intervalId = setInterval(function () {
            hours = parseInt(timer / 3600, 10);
            minutes = parseInt((timer % 3600) / 60, 10);
            seconds = parseInt(timer % 60, 10);

            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = hours + ":" + minutes + ":" + seconds;

            if (--timer < 0) {
                timer = 0;
                display.textContent = "TIME UP";
                clearInterval(intervalId);
                alert("Time's up! The exam has automatically ended.");
            }
        }, 1000);
    }

    // --- 4. Initialization (Runs when page loads) ---
    window.onload = function () {
        // Start Timer (3 hours)
        let threeHours = 60 * 60 * 3; 
        let display = document.querySelector('#time-remaining');
        startTimer(threeHours, display);

        // Attach event listeners to navigation buttons
        document.querySelector('.nav-btn.next').addEventListener('click', handleNext);
        document.querySelector('.nav-btn.prev').addEventListener('click', handlePrevious);
        
        document.querySelector('.flag-btn').addEventListener('click', () => {
             alert(`Question ${currentQuestionIndex + 1} flagged for review!`);
        });

        // Load the first question
        loadQuestion(currentQuestionIndex);
    };
</script>
